<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ú–æ–π —Ä–∞–±–æ—á–∏–π –≥—Ä–∞—Ñ–∏–∫</title>
  <style>
    :root {
      --primary-color: #4CAF50;
      --secondary-color: #2196F3;
      --weekend-color: #d32f2f;
      --today-color: #c8e6c9;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #e0f7fa, #e1bee7);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      min-height: 100vh;
    }
    
    .container {
      width: 100%;
      max-width: 1000px;
    }
    
    h1 {
      margin: 10px 0;
      color: #333;
      text-align: center;
      font-size: clamp(1.5em, 4vw, 2em);
    }
    
    .auth-overlay {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0,0,0,0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
    }
    
    .auth-form {
      background: white;
      padding: 30px;
      border-radius: 15px;
      text-align: center;
      width: 90%;
      max-width: 400px;
    }
    
    .password-input {
      padding: 12px;
      border: 2px solid #ddd;
      border-radius: 8px;
      font-size: 1em;
      width: 100%;
      margin: 15px 0;
    }
    
    .auth-button {
      padding: 12px 25px;
      background: var(--primary-color);
      color: white;
      border: none;
      border-radius: 8px;
      cursor: pointer;
      font-size: 1em;
      width: 100%;
    }
    
    .week-nav {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    
    .week-nav button {
      padding: 10px 15px;
      border: none;
      border-radius: 8px;
      background: white;
      cursor: pointer;
      font-size: 0.9em;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      transition: all 0.2s;
      min-width: 100px;
    }
    
    .week-nav button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    
    #week-range {
      font-weight: bold;
      color: #333;
      text-align: center;
      min-width: 200px;
      font-size: clamp(0.9em, 3vw, 1.1em);
      padding: 0 10px;
    }
    
    .calendar {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
      gap: 10px;
      margin: 20px 0;
      width: 100%;
    }
    
    .day-card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      padding: 15px 10px;
      text-align: center;
      transition: all 0.3s ease;
      min-height: 140px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    
    .day-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.15);
    }
    
    .date {
      font-size: 1.1em;
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .weekday {
      color: #666;
      margin-bottom: 10px;
      font-size: 0.9em;
    }
    
    .time-select, .time-display {
      padding: 8px 5px;
      border-radius: 6px;
      font-size: 0.85em;
      width: 100%;
      margin-top: 8px;
      transition: all 0.2s;
    }
    
    .time-select {
      border: 2px solid #4CAF50;
      background: white;
      cursor: pointer;
    }
    
    .time-select:focus {
      outline: none;
      box-shadow: 0 0 5px rgba(76, 175, 80, 0.5);
    }
    
    .time-display {
      background: #f5f5f5;
      font-weight: bold;
      color: #333;
      border: 1px solid #ddd;
    }
    
    .today {
      background: var(--today-color);
      border: 2px solid #388E3C;
    }
    
    .weekend {
      background: #ffe0e0;
    }
    
    .past-day {
      opacity: 0.7;
    }
    
    .weekend-label {
      color: var(--weekend-color);
      font-weight: bold;
      margin-top: 8px;
      font-size: 0.9em;
      padding: 5px;
      background: rgba(255,255,255,0.7);
      border-radius: 5px;
    }
    
    .work-stats {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      margin: 20px 0;
      width: 100%;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 15px;
      margin: 15px 0;
    }
    
    .stat-card {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      border-left: 4px solid #2196F3;
    }
    
    .stat-value {
      font-size: 1.4em;
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .edit-notice {
      background: #FFF3E0;
      border: 1px solid #FFB74D;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
      text-align: center;
      width: 100%;
    }
    
    .sync-status {
      text-align: center;
      margin: 10px 0;
      font-size: 0.9em;
      min-height: 20px;
    }

    #current-time {
      font-size: clamp(0.9em, 3vw, 1.1em);
      margin-bottom: 10px;
      text-align: center;
    }

    .admin-badge {
      background: var(--primary-color);
      color: white;
      padding: 5px 15px;
      border-radius: 15px;
      font-size: 0.8em;
      margin: 0 auto 10px auto;
      display: inline-block;
    }

    /* –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è */
    @media (max-width: 480px) {
      body {
        padding: 10px;
      }
      
      .calendar {
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
      }
      
      .day-card {
        padding: 12px 8px;
        min-height: 130px;
      }
      
      .week-nav {
        gap: 5px;
      }
      
      .week-nav button {
        padding: 8px 12px;
        min-width: 80px;
        font-size: 0.8em;
      }
      
      #week-range {
        min-width: 150px;
        font-size: 0.9em;
      }
      
      .work-stats {
        padding: 15px;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
        gap: 10px;
      }
    }

    @media (max-width: 320px) {
      .calendar {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <!-- –û–∫–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ -->
  <div class="auth-overlay" id="authOverlay" style="display: none;">
    <div class="auth-form">
      <h2>üîê –î–æ—Å—Ç—É–ø –∫ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—é</h2>
      <p>–í–≤–µ–¥–∏—Ç–µ –ø–∞—Ä–æ–ª—å –¥–ª—è –∏–∑–º–µ–Ω–µ–Ω–∏—è –≥—Ä–∞—Ñ–∏–∫–∞:</p>
      <input type="password" class="password-input" id="passwordInput" 
             placeholder="–ü–∞—Ä–æ–ª—å —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞" autocomplete="off">
      <button class="auth-button" onclick="checkPassword()">–í–æ–π—Ç–∏</button>
      <p style="margin-top: 15px; color: #666; font-size: 0.9em;">
        –î–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ –≥—Ä–∞—Ñ–∏–∫–∞ –∑–∞–∫—Ä–æ–π—Ç–µ —ç—Ç–æ –æ–∫–Ω–æ
      </p>
    </div>
  </div>

  <div class="container">
    <div id="mainContent">
      <!-- –ë–µ–π–¥–∂ —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ -->
      <div class="admin-badge" id="adminBadge" style="display: none;">üîß –†–µ–¥–∞–∫—Ç–æ—Ä</div>
      
      <h1>üìÖ –ú–æ–π —Ä–∞–±–æ—á–∏–π –≥—Ä–∞—Ñ–∏–∫</h1>
      <div id="current-time"></div>
      <div class="sync-status" id="syncStatus">üîÑ –ó–∞–≥—Ä—É–∑–∫–∞...</div>
      
      <div class="week-nav">
        <button id="prev-week">‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∞—è</button>
        <span id="week-range"></span>
        <button id="next-week">–°–ª–µ–¥—É—é—â–∞—è ‚Üí</button>
      </div>
      
      <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ -->
      <div class="edit-notice" id="editNotice" style="display: none;">
        <strong>üîß –í—ã –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è!</strong>
        <p style="margin: 5px 0 0 0; font-size: 0.9em;">
          –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ –æ–±–ª–∞–∫–µ –∏ —Å—Ä–∞–∑—É –≤–∏–¥–Ω—ã –≤—Å–µ–º
        </p>
      </div>
      
      <div class="calendar" id="calendar"></div>
      
      <div class="work-stats">
        <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–µ–¥–µ–ª–∏</h3>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-value" id="work-days">0</div>
            <div>–†–∞–±–æ—á–∏—Ö –¥–Ω–µ–π</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="weekend-days">0</div>
            <div>–í—ã—Ö–æ–¥–Ω—ã—Ö –¥–Ω–µ–π</div>
          </div>
        </div>
        <div style="margin-top: 15px; padding: 12px; background: #e8f5e9; border-radius: 8px;">
          <strong>üïê –ë–ª–∏–∂–∞–π—à–∏–π —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å:</strong>
          <div id="next-workday-info" style="font-weight: bold; margin-top: 5px;">-</div>
        </div>
      </div>
    </div>
  </div>

  <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º Firebase -->
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-app-compat.js"></script>
  <script src="https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore-compat.js"></script>

  <script>
    // üîß –ö–û–ù–§–ò–ì–£–†–ê–¶–ò–Ø FIREBASE
const firebaseConfig = {
  apiKey: "AIzaSyCB_bwtspz0GuQeialypinwih1VQ1E30wo",
  authDomain: "my-schedule-b323f.firebaseapp.com",
  projectId: "my-schedule-b323f",
  storageBucket: "my-schedule-b323f.firebasestorage.app",
  messagingSenderId: "2949606491",
  appId: "1:2949606491:web:2a0f37da954c0d1267237e"
};

    // üîê –ü–ê–†–û–õ–¨ –î–õ–Ø –†–ï–î–ê–ö–¢–ò–†–û–í–ê–ù–ò–Ø
    const ADMIN_PASSWORD = "123";

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase
    firebase.initializeApp(firebaseConfig);
    const db = firebase.firestore();

    const weekdays = ["–ü–Ω", "–í—Ç", "–°—Ä", "–ß—Ç", "–ü—Ç", "–°–±", "–í—Å"];
    let currentMonday = new Date();
    let isEditMode = false;
    let scheduleData = {};

    // –≠–ª–µ–º–µ–Ω—Ç—ã DOM
    const elements = {
      calendar: document.getElementById("calendar"),
      weekRange: document.getElementById("week-range"),
      prevWeek: document.getElementById("prev-week"),
      nextWeek: document.getElementById("next-week"),
      authOverlay: document.getElementById("authOverlay"),
      passwordInput: document.getElementById("passwordInput"),
      syncStatus: document.getElementById("syncStatus"),
      adminBadge: document.getElementById("adminBadge"),
      editNotice: document.getElementById("editNotice")
    };

    // üîê –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–∞—Ä–æ–ª—è
    function checkPassword() {
      if (elements.passwordInput.value === ADMIN_PASSWORD) {
        isEditMode = true;
        elements.authOverlay.style.display = 'none';
        elements.editNotice.style.display = 'block';
        elements.adminBadge.style.display = 'block';
        renderCalendar();
        updateSyncStatus('‚úÖ –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –∞–∫—Ç–∏–≤–µ–Ω', 'green');
      } else {
        alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π –ø–∞—Ä–æ–ª—å');
      }
    }

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –æ–∫–Ω–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –¥–ª—è –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
    elements.authOverlay.addEventListener('click', (e) => {
      if (e.target === elements.authOverlay) {
        isEditMode = false;
        elements.authOverlay.style.display = 'none';
        renderCalendar();
        updateSyncStatus('üëÅÔ∏è –†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞', 'blue');
      }
    });

    // Enter –¥–ª—è –≤–≤–æ–¥–∞ –ø–∞—Ä–æ–ª—è
    elements.passwordInput.addEventListener('keypress', (e) => {
      if (e.key === 'Enter') checkPassword();
    });

    // üì° –†–∞–±–æ—Ç–∞ —Å Firebase Firestore
    async function saveToFirestore(date, time) {
      try {
        await db.collection('schedule').doc(date).set({
          time: time,
          updatedAt: firebase.firestore.FieldValue.serverTimestamp()
        }, { merge: true });
        
        updateSyncStatus('‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ –æ–±–ª–∞–∫–µ', 'green');
        return true;
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', error);
        updateSyncStatus('‚ùå –û—à–∏–±–∫–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è', 'red');
        
        // –°–æ—Ö—Ä–∞–Ω—è–µ–º –≤ localStorage –∫–∞–∫ –∑–∞–ø–∞—Å–Ω–æ–π –≤–∞—Ä–∏–∞–Ω—Ç
        try {
          scheduleData[date] = time;
          localStorage.setItem('schedule_backup', JSON.stringify(scheduleData));
        } catch (e) {
          console.error('–û—à–∏–±–∫–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è:', e);
        }
        
        return false;
      }
    }

    async function loadFromFirestore() {
      try {
        const snapshot = await db.collection('schedule').get();
        const data = {};
        snapshot.forEach(doc => {
          data[doc.id] = doc.data().time;
        });
        scheduleData = data;
        updateSyncStatus('‚úÖ –î–∞–Ω–Ω—ã–µ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –∏–∑ –æ–±–ª–∞–∫–∞', 'green');
        return data;
      } catch (error) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∏–∑ Firestore:', error);
        // –ü—Ä–æ–±—É–µ–º –∑–∞–≥—Ä—É–∑–∏—Ç—å –∏–∑ localStorage
        return loadFromLocalStorage();
      }
    }

    function loadFromLocalStorage() {
      try {
        const backup = localStorage.getItem('schedule_backup');
        if (backup) {
          scheduleData = JSON.parse(backup);
          updateSyncStatus('‚ö†Ô∏è –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ', 'orange');
          return scheduleData;
        }
      } catch (e) {
        console.error('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:', e);
      }
      
      scheduleData = {};
      return scheduleData;
    }

    // üîÑ –°–ª—É—à–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏
    function setupRealtimeListener() {
      db.collection('schedule').onSnapshot((snapshot) => {
        const changes = snapshot.docChanges();
        let hasChanges = false;
        
        changes.forEach(change => {
          if (change.type === 'added' || change.type === 'modified') {
            scheduleData[change.doc.id] = change.doc.data().time;
            hasChanges = true;
          } else if (change.type === 'removed') {
            delete scheduleData[change.doc.id];
            hasChanges = true;
          }
        });
        
        if (hasChanges && !isEditMode) {
          renderCalendar();
          updateSyncStatus('üîÑ –î–∞–Ω–Ω—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω—ã', 'blue');
        }
      }, (error) => {
        console.error('–û—à–∏–±–∫–∞ real-time listener:', error);
        updateSyncStatus('‚ö†Ô∏è –û—Ñ—Ñ–ª–∞–π–Ω —Ä–µ–∂–∏–º', 'orange');
      });
    }

    function updateSyncStatus(message, color) {
      elements.syncStatus.textContent = message;
      elements.syncStatus.style.color = color;
    }

    // üìÖ –§—É–Ω–∫—Ü–∏–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—è
    function setMonday(date) {
      const safeDate = new Date(date);
      const monday = new Date(safeDate);
      const day = safeDate.getDay();
      const diff = safeDate.getDate() - day + (day === 0 ? -6 : 1);
      monday.setDate(diff);
      return monday;
    }

    function updateTime() {
      try {
        const now = new Date();
        document.getElementById("current-time").textContent = 
          `–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è: ${now.toLocaleTimeString('ru-RU')}`;
      } catch (e) {
        console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏:', e);
      }
    }

    function formatWeekRange(monday) {
      try {
        const sunday = new Date(monday);
        sunday.setDate(monday.getDate() + 6);
        return `${monday.toLocaleDateString("ru-RU", { day: "2-digit", month: "2-digit" })} - ${sunday.toLocaleDateString("ru-RU", { day: "2-digit", month: "2-digit" })}`;
      } catch (e) {
        return '–û—à–∏–±–∫–∞ –¥–∞—Ç—ã';
      }
    }

    function updateCardStyle(card, time) {
      card.style.borderLeft = '4px solid transparent';
      if (time === '07:30') card.style.borderLeftColor = '#4CAF50';
      else if (time === '12:00') card.style.borderLeftColor = '#FF9800';
      else if (time === '18:00') card.style.borderLeftColor = '#9C27B0';
    }

    function getTimeForDate(date) {
      const key = date.toISOString().split('T')[0];
      return scheduleData[key] || '07:30';
    }

    function findNextWorkday() {
      try {
        const today = new Date();
        let nextDay = new Date(today);
        
        for (let i = 1; i <= 7; i++) {
          nextDay.setDate(today.getDate() + i);
          const dayOfWeek = nextDay.getDay();
          if (dayOfWeek !== 0 && dayOfWeek !== 6) {
            const savedTime = getTimeForDate(nextDay);
            return {
              date: nextDay,
              time: savedTime
            };
          }
        }
        return null;
      } catch (e) {
        return null;
      }
    }

    function updateStats() {
      try {
        const workDays = document.querySelectorAll('.day-card:not(.weekend)').length;
        const weekendDays = document.querySelectorAll('.day-card.weekend').length;
        
        document.getElementById('work-days').textContent = workDays;
        document.getElementById('weekend-days').textContent = weekendDays;
        
        const nextWorkday = findNextWorkday();
        if (nextWorkday) {
          const dateStr = nextWorkday.date.toLocaleDateString("ru-RU", { 
            day: "2-digit", 
            month: "2-digit",
            weekday: 'short'
          });
          document.getElementById('next-workday-info').textContent = 
            `${dateStr} –≤ ${nextWorkday.time}`;
        } else {
          document.getElementById('next-workday-info').textContent = '–ù–µ –Ω–∞–π–¥–µ–Ω–æ';
        }
      } catch (e) {
        console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', e);
      }
    }

    function renderCalendar() {
      try {
        elements.calendar.innerHTML = '';
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        
        elements.weekRange.textContent = formatWeekRange(currentMonday);

        for (let i = 0; i < 7; i++) {
          const day = new Date(currentMonday);
          day.setDate(currentMonday.getDate() + i);
          day.setHours(0, 0, 0, 0);
          const dayKey = day.toISOString().split('T')[0];

          const card = document.createElement("div");
          card.className = "day-card";

          const isWeekend = i >= 5;
          if (isWeekend) card.classList.add("weekend");
          
          const todayNormalized = new Date(today);
          todayNormalized.setHours(0, 0, 0, 0);
          const dayNormalized = new Date(day);
          dayNormalized.setHours(0, 0, 0, 0);
          
          if (dayNormalized.getTime() === todayNormalized.getTime()) {
            card.classList.add("today");
          }
          if (dayNormalized < todayNormalized && dayNormalized.getTime() !== todayNormalized.getTime()) {
            card.classList.add("past-day");
          }

          const dateEl = document.createElement("div");
          dateEl.className = "date";
          dateEl.textContent = day.toLocaleDateString("ru-RU", { day: "2-digit", month: "2-digit" });

          const weekdayEl = document.createElement("div");
          weekdayEl.className = "weekday";
          weekdayEl.textContent = weekdays[i];

          card.appendChild(dateEl);
          card.appendChild(weekdayEl);

          if (!isWeekend) {
            const savedTime = getTimeForDate(day);
            
            if (isEditMode) {
              const select = document.createElement("select");
              select.className = "time-select";
              
              ["07:30", "12:00", "18:00"].forEach(time => {
                const option = document.createElement("option");
                option.value = time;
                option.textContent = time;
                if (time === savedTime) option.selected = true;
                select.appendChild(option);
              });

              select.addEventListener('change', async () => {
                await saveToFirestore(dayKey, select.value);
                updateCardStyle(card, select.value);
                updateStats();
              });

              card.appendChild(select);
              updateCardStyle(card, savedTime);
            } else {
              const timeDisplay = document.createElement("div");
              timeDisplay.className = "time-display";
              timeDisplay.textContent = savedTime;
              card.appendChild(timeDisplay);
              updateCardStyle(card, savedTime);
            }
          } else {
            const weekendLabel = document.createElement("div");
            weekendLabel.className = "weekend-label";
            weekendLabel.textContent = "–í—ã—Ö–æ–¥–Ω–æ–π";
            card.appendChild(weekendLabel);
          }

          elements.calendar.appendChild(card);
        }
        updateStats();
      } catch (e) {
        console.error('–û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä—è:', e);
        elements.calendar.innerHTML = '<div style="text-align: center; color: red; padding: 20px;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—è</div>';
      }
    }

    // üöÄ –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    async function init() {
      currentMonday = setMonday(new Date());
      
      // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
      await loadFromFirestore();
      
      // –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ–º real-time listener
      setupRealtimeListener();
      
      // –ü—Ä–æ–≤–µ—Ä—è–µ–º —Ä–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –ø–æ URL
      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.get('mode') === 'edit') {
        elements.authOverlay.style.display = 'flex';
      } else {
        // –†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞
        renderCalendar();
      }
      
      // –ù–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –Ω–µ–¥–µ–ª—è–º
      elements.prevWeek.addEventListener('click', () => {
        currentMonday.setDate(currentMonday.getDate() - 7);
        renderCalendar();
      });
      
      elements.nextWeek.addEventListener('click', () => {
        currentMonday.setDate(currentMonday.getDate() + 7);
        renderCalendar();
      });

      // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏
      updateTime();
      setInterval(updateTime, 1000);

      // –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏–∑–º–µ–Ω–µ–Ω–∏—è –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ —ç–∫—Ä–∞–Ω–∞
      window.addEventListener('orientationchange', () => {
        setTimeout(renderCalendar, 100);
      });
    }

    // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∫–æ–≥–¥–∞ DOM –≥–æ—Ç–æ–≤
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  </script>
</body>
</html>
