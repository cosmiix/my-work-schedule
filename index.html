<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ú–æ–π —Ä–∞–±–æ—á–∏–π –≥—Ä–∞—Ñ–∏–∫</title>
  <style>
    :root {
      --primary-color: #4CAF50;
      --secondary-color: #2196F3;
      --weekend-color: #d32f2f;
      --today-color: #c8e6c9;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #e0f7fa, #e1bee7);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      min-height: 100vh;
    }
    
    .container {
      width: 100%;
      max-width: 1000px;
    }
    
    h1 {
      margin: 10px 0;
      color: #333;
      text-align: center;
      font-size: clamp(1.5em, 4vw, 2em);
    }
    
    .week-nav {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 10px;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    
    .week-nav button {
      padding: 10px 15px;
      border: none;
      border-radius: 8px;
      background: white;
      cursor: pointer;
      font-size: 0.9em;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      transition: all 0.2s;
      min-width: 100px;
    }
    
    .week-nav button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    
    #week-range {
      font-weight: bold;
      color: #333;
      text-align: center;
      min-width: 200px;
      font-size: clamp(0.9em, 3vw, 1.1em);
      padding: 0 10px;
    }
    
    .calendar {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(130px, 1fr));
      gap: 10px;
      margin: 20px 0;
      width: 100%;
    }
    
    .day-card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      padding: 15px 10px;
      text-align: center;
      transition: all 0.3s ease;
      min-height: 140px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }
    
    .day-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.15);
    }
    
    .date {
      font-size: 1.1em;
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .weekday {
      color: #666;
      margin-bottom: 10px;
      font-size: 0.9em;
    }
    
    .time-select, .time-display {
      padding: 8px 5px;
      border-radius: 6px;
      font-size: 0.85em;
      width: 100%;
      margin-top: 8px;
      transition: all 0.2s;
    }
    
    .time-select {
      border: 2px solid #4CAF50;
      background: white;
      cursor: pointer;
    }
    
    .time-select:focus {
      outline: none;
      box-shadow: 0 0 5px rgba(76, 175, 80, 0.5);
    }
    
    .time-display {
      background: #f5f5f5;
      font-weight: bold;
      color: #333;
      border: 1px solid #ddd;
    }
    
    .today {
      background: var(--today-color);
      border: 2px solid #388E3C;
    }
    
    .weekend {
      background: #ffe0e0;
    }
    
    .past-day {
      opacity: 0.7;
    }
    
    .weekend-label {
      color: var(--weekend-color);
      font-weight: bold;
      margin-top: 8px;
      font-size: 0.9em;
      padding: 5px;
      background: rgba(255,255,255,0.7);
      border-radius: 5px;
    }
    
    .work-stats {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      margin: 20px 0;
      width: 100%;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 15px;
      margin: 15px 0;
    }
    
    .stat-card {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      border-left: 4px solid #2196F3;
    }
    
    .stat-value {
      font-size: 1.4em;
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .edit-notice {
      background: #FFF3E0;
      border: 1px solid #FFB74D;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
      text-align: center;
      width: 100%;
    }

    #current-time {
      font-size: clamp(0.9em, 3vw, 1.1em);
      margin-bottom: 10px;
      text-align: center;
    }

    /* –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è */
    @media (max-width: 480px) {
      body {
        padding: 10px;
      }
      
      .calendar {
        grid-template-columns: repeat(2, 1fr);
        gap: 8px;
      }
      
      .day-card {
        padding: 12px 8px;
        min-height: 130px;
      }
      
      .week-nav {
        gap: 5px;
      }
      
      .week-nav button {
        padding: 8px 12px;
        min-width: 80px;
        font-size: 0.8em;
      }
      
      #week-range {
        min-width: 150px;
        font-size: 0.9em;
      }
      
      .work-stats {
        padding: 15px;
      }
      
      .stats-grid {
        grid-template-columns: 1fr;
        gap: 10px;
      }
    }

    @media (max-width: 320px) {
      .calendar {
        grid-template-columns: 1fr;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="mainContent">
      <h1>üìÖ –ú–æ–π —Ä–∞–±–æ—á–∏–π –≥—Ä–∞—Ñ–∏–∫</h1>
      <div id="current-time"></div>
      
      <div class="week-nav">
        <button id="prev-week">‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∞—è</button>
        <span id="week-range"></span>
        <button id="next-week">–°–ª–µ–¥—É—é—â–∞—è ‚Üí</button>
      </div>
      
      <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ -->
      <div class="edit-notice" id="editNotice" style="display: none;">
        <strong>üîß –í—ã –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è!</strong>
        <p style="margin: 5px 0 0 0; font-size: 0.9em;">
          –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
        </p>
      </div>
      
      <div class="calendar" id="calendar"></div>
      
      <div class="work-stats">
        <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–µ–¥–µ–ª–∏</h3>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-value" id="work-days">0</div>
            <div>–†–∞–±–æ—á–∏—Ö –¥–Ω–µ–π</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="weekend-days">0</div>
            <div>–í—ã—Ö–æ–¥–Ω—ã—Ö –¥–Ω–µ–π</div>
          </div>
        </div>
        <div style="margin-top: 15px; padding: 12px; background: #e8f5e9; border-radius: 8px;">
          <strong>üïê –ë–ª–∏–∂–∞–π—à–∏–π —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å:</strong>
          <div id="next-workday-info" style="font-weight: bold; margin-top: 5px;">-</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    // –£–ª—É—á—à–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
    const weekdays = ["–ü–Ω", "–í—Ç", "–°—Ä", "–ß—Ç", "–ü—Ç", "–°–±", "–í—Å"];
    let currentMonday = new Date();
    let isEditMode = false;

    // –ë–µ–∑–æ–ø–∞—Å–Ω–æ–µ –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–∞—Ç—ã
    function getSafeDate(date) {
      try {
        return new Date(date);
      } catch (e) {
        console.error('–û—à–∏–±–∫–∞ —Å–æ–∑–¥–∞–Ω–∏—è –¥–∞—Ç—ã:', e);
        return new Date();
      }
    }

    // –ë–µ–∑–æ–ø–∞—Å–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å localStorage
    function safeLocalStorageGet(key) {
      try {
        return localStorage.getItem(key);
      } catch (e) {
        console.error('–û—à–∏–±–∫–∞ localStorage:', e);
        return null;
      }
    }

    function safeLocalStorageSet(key, value) {
      try {
        localStorage.setItem(key, value);
        return true;
      } catch (e) {
        console.error('–û—à–∏–±–∫–∞ localStorage:', e);
        return false;
      }
    }

    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–∂–∏–º –ø–æ URL
    function checkUrlMode() {
      try {
        const urlParams = new URLSearchParams(window.location.search);
        isEditMode = urlParams.get('mode') === 'edit';
        
        if (isEditMode) {
          document.getElementById('editNotice').style.display = 'block';
        }
      } catch (e) {
        console.error('–û—à–∏–±–∫–∞ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è —Ä–µ–∂–∏–º–∞:', e);
      }
    }

    const elements = {
      calendar: document.getElementById("calendar"),
      weekRange: document.getElementById("week-range"),
      prevWeek: document.getElementById("prev-week"),
      nextWeek: document.getElementById("next-week")
    };

    function setMonday(date) {
      const safeDate = getSafeDate(date);
      const monday = new Date(safeDate);
      const day = safeDate.getDay();
      const diff = safeDate.getDate() - day + (day === 0 ? -6 : 1); // –ö–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π —Ä–∞—Å—á–µ—Ç –ø–æ–Ω–µ–¥–µ–ª—å–Ω–∏–∫–∞
      monday.setDate(diff);
      return monday;
    }

    function updateTime() {
      try {
        const now = new Date();
        document.getElementById("current-time").textContent = 
          `–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è: ${now.toLocaleTimeString('ru-RU')}`;
      } catch (e) {
        console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏:', e);
      }
    }

    function formatWeekRange(monday) {
      try {
        const sunday = new Date(monday);
        sunday.setDate(monday.getDate() + 6);
        return `${monday.toLocaleDateString("ru-RU", { day: "2-digit", month: "2-digit" })} - ${sunday.toLocaleDateString("ru-RU", { day: "2-digit", month: "2-digit" })}`;
      } catch (e) {
        console.error('–û—à–∏–±–∫–∞ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –¥–∞—Ç—ã:', e);
        return '–û—à–∏–±–∫–∞ –¥–∞—Ç—ã';
      }
    }

    function updateCardStyle(card, time) {
      card.style.borderLeft = '4px solid transparent';
      if (time === '07:30') card.style.borderLeftColor = '#4CAF50';
      else if (time === '12:00') card.style.borderLeftColor = '#FF9800';
      else if (time === '18:00') card.style.borderLeftColor = '#9C27B0';
    }

    function findNextWorkday() {
      try {
        const today = new Date();
        let nextDay = new Date(today);
        
        for (let i = 1; i <= 7; i++) {
          nextDay.setDate(today.getDate() + i);
          const dayOfWeek = nextDay.getDay();
          if (dayOfWeek !== 0 && dayOfWeek !== 6) {
            const storageKey = `time_${nextDay.toISOString().split('T')[0]}`;
            const savedTime = safeLocalStorageGet(storageKey) || '07:30';
            return {
              date: nextDay,
              time: savedTime
            };
          }
        }
        return null;
      } catch (e) {
        console.error('–û—à–∏–±–∫–∞ –ø–æ–∏—Å–∫–∞ —Ä–∞–±–æ—á–µ–≥–æ –¥–Ω—è:', e);
        return null;
      }
    }

    function updateStats() {
      try {
        const workDays = document.querySelectorAll('.day-card:not(.weekend)').length;
        const weekendDays = document.querySelectorAll('.day-card.weekend').length;
        
        document.getElementById('work-days').textContent = workDays;
        document.getElementById('weekend-days').textContent = weekendDays;
        
        const nextWorkday = findNextWorkday();
        if (nextWorkday) {
          const dateStr = nextWorkday.date.toLocaleDateString("ru-RU", { 
            day: "2-digit", 
            month: "2-digit",
            weekday: 'short'
          });
          document.getElementById('next-workday-info').textContent = 
            `${dateStr} –≤ ${nextWorkday.time}`;
        } else {
          document.getElementById('next-workday-info').textContent = '–ù–µ –Ω–∞–π–¥–µ–Ω–æ';
        }
      } catch (e) {
        console.error('–û—à–∏–±–∫–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:', e);
      }
    }

    function renderCalendar() {
      try {
        elements.calendar.innerHTML = '';
        const today = new Date();
        today.setHours(0, 0, 0, 0); // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –¥–∞—Ç—É
        
        elements.weekRange.textContent = formatWeekRange(currentMonday);

        for (let i = 0; i < 7; i++) {
          const day = new Date(currentMonday);
          day.setDate(currentMonday.getDate() + i);
          day.setHours(0, 0, 0, 0); // –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º –¥–∞—Ç—É

          const card = document.createElement("div");
          card.className = "day-card";

          const isWeekend = i >= 5;
          if (isWeekend) card.classList.add("weekend");
          
          // –°—Ä–∞–≤–Ω–∏–≤–∞–µ–º –Ω–æ—Ä–º–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –¥–∞—Ç—ã
          const todayNormalized = new Date(today);
          todayNormalized.setHours(0, 0, 0, 0);
          const dayNormalized = new Date(day);
          dayNormalized.setHours(0, 0, 0, 0);
          
          if (dayNormalized.getTime() === todayNormalized.getTime()) {
            card.classList.add("today");
          }
          if (dayNormalized < todayNormalized && dayNormalized.getTime() !== todayNormalized.getTime()) {
            card.classList.add("past-day");
          }

          const dateEl = document.createElement("div");
          dateEl.className = "date";
          dateEl.textContent = day.toLocaleDateString("ru-RU", { day: "2-digit", month: "2-digit" });

          const weekdayEl = document.createElement("div");
          weekdayEl.className = "weekday";
          weekdayEl.textContent = weekdays[i];

          card.appendChild(dateEl);
          card.appendChild(weekdayEl);

          if (!isWeekend) {
            const storageKey = `time_${day.toISOString().split('T')[0]}`;
            const savedTime = safeLocalStorageGet(storageKey) || '07:30';
            
            if (isEditMode) {
              const select = document.createElement("select");
              select.className = "time-select";
              
              ["07:30", "12:00", "18:00"].forEach(time => {
                const option = document.createElement("option");
                option.value = time;
                option.textContent = time;
                if (time === savedTime) option.selected = true;
                select.appendChild(option);
              });

              select.addEventListener('change', () => {
                safeLocalStorageSet(storageKey, select.value);
                updateCardStyle(card, select.value);
                updateStats();
              });

              card.appendChild(select);
            } else {
              const timeDisplay = document.createElement("div");
              timeDisplay.className = "time-display";
              timeDisplay.textContent = savedTime;
              card.appendChild(timeDisplay);
            }
            updateCardStyle(card, savedTime);
          } else {
            const weekendLabel = document.createElement("div");
            weekendLabel.className = "weekend-label";
            weekendLabel.textContent = "–í—ã—Ö–æ–¥–Ω–æ–π";
            card.appendChild(weekendLabel);
          }

          elements.calendar.appendChild(card);
        }
        updateStats();
      } catch (e) {
        console.error('–û—à–∏–±–∫–∞ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–∞ –∫–∞–ª–µ–Ω–¥–∞—Ä—è:', e);
        elements.calendar.innerHTML = '<div style="text-align: center; color: red;">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –∫–∞–ª–µ–Ω–¥–∞—Ä—è</div>';
      }
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    function init() {
      try {
        currentMonday = setMonday(new Date());
        checkUrlMode();
        renderCalendar();
        
        elements.prevWeek.addEventListener('click', () => {
          currentMonday.setDate(currentMonday.getDate() - 7);
          renderCalendar();
        });
        
        elements.nextWeek.addEventListener('click', () => {
          currentMonday.setDate(currentMonday.getDate() + 7);
          renderCalendar();
        });

        updateTime();
        setInterval(updateTime, 1000);

        // –ü–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –æ—Ä–∏–µ–Ω—Ç–∞—Ü–∏–∏ —ç–∫—Ä–∞–Ω–∞
        window.addEventListener('resize', renderCalendar);
        window.addEventListener('orientationchange', () => {
          setTimeout(renderCalendar, 100);
        });

      } catch (e) {
        console.error('–û—à–∏–±–∫–∞ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏:', e);
      }
    }

    // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∫–æ–≥–¥–∞ DOM –≥–æ—Ç–æ–≤
    if (document.readyState === 'loading') {
      document.addEventListener('DOMContentLoaded', init);
    } else {
      init();
    }
  </script>
</body>
</html>
