<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>–ú–æ–π —Ä–∞–±–æ—á–∏–π –≥—Ä–∞—Ñ–∏–∫</title>
  <style>
    :root {
      --primary-color: #4CAF50;
      --secondary-color: #2196F3;
      --weekend-color: #d32f2f;
      --today-color: #c8e6c9;
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: "Segoe UI", Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #e0f7fa, #e1bee7);
      display: flex;
      flex-direction: column;
      align-items: center;
      padding: 20px;
      min-height: 100vh;
    }
    
    .container {
      width: 100%;
      max-width: 1000px;
    }
    
    h1 {
      margin: 10px 0;
      color: #333;
      text-align: center;
    }
    
    .week-nav {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
      margin: 20px 0;
      flex-wrap: wrap;
    }
    
    .week-nav button {
      padding: 8px 15px;
      border: none;
      border-radius: 8px;
      background: white;
      cursor: pointer;
      font-size: 0.9em;
      box-shadow: 0 2px 5px rgba(0,0,0,0.1);
      transition: all 0.2s;
    }
    
    .week-nav button:hover {
      transform: translateY(-2px);
      box-shadow: 0 4px 8px rgba(0,0,0,0.15);
    }
    
    #week-range {
      font-weight: bold;
      color: #333;
      text-align: center;
      min-width: 200px;
    }
    
    .calendar {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
      gap: 12px;
      margin: 20px 0;
    }
    
    .day-card {
      background: white;
      border-radius: 12px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      padding: 15px;
      text-align: center;
      transition: all 0.3s ease;
    }
    
    .day-card:hover {
      transform: translateY(-2px);
      box-shadow: 0 5px 15px rgba(0,0,0,0.15);
    }
    
    .date {
      font-size: 1.1em;
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .weekday {
      color: #666;
      margin-bottom: 10px;
      font-size: 0.9em;
    }
    
    .time-select, .time-display {
      padding: 8px;
      border-radius: 6px;
      font-size: 0.9em;
      width: 100%;
      margin-top: 8px;
      transition: all 0.2s;
    }
    
    .time-select {
      border: 2px solid #4CAF50;
      background: white;
      cursor: pointer;
    }
    
    .time-select:focus {
      outline: none;
      box-shadow: 0 0 5px rgba(76, 175, 80, 0.5);
    }
    
    .time-display {
      background: #f5f5f5;
      font-weight: bold;
      color: #333;
      border: 1px solid #ddd;
    }
    
    .today {
      background: var(--today-color);
      border: 2px solid #388E3C;
    }
    
    .weekend {
      background: #ffe0e0;
    }
    
    .past-day {
      opacity: 0.7;
    }
    
    .weekend-label {
      color: var(--weekend-color);
      font-weight: bold;
      margin-top: 8px;
      font-size: 0.9em;
      padding: 5px;
      background: rgba(255,255,255,0.7);
      border-radius: 5px;
    }
    
    .work-stats {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 3px 10px rgba(0,0,0,0.1);
      margin: 20px 0;
    }
    
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 15px;
      margin: 15px 0;
    }
    
    .stat-card {
      background: #f8f9fa;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
      border-left: 4px solid #2196F3;
    }
    
    .stat-value {
      font-size: 1.4em;
      font-weight: bold;
      margin-bottom: 5px;
    }
    
    .edit-notice {
      background: #FFF3E0;
      border: 1px solid #FFB74D;
      border-radius: 8px;
      padding: 15px;
      margin: 15px 0;
      text-align: center;
    }
  </style>
</head>
<body>
  <div class="container">
    <div id="mainContent">
      <h1>üìÖ –ú–æ–π —Ä–∞–±–æ—á–∏–π –≥—Ä–∞—Ñ–∏–∫</h1>
      <div id="current-time"></div>
      
      <div class="week-nav">
        <button id="prev-week">‚Üê –ü—Ä–µ–¥—ã–¥—É—â–∞—è</button>
        <span id="week-range"></span>
        <button id="next-week">–°–ª–µ–¥—É—é—â–∞—è ‚Üí</button>
      </div>
      
      <!-- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –¥–ª—è —Ä–µ–¥–∞–∫—Ç–æ—Ä–∞ -->
      <div class="edit-notice" id="editNotice" style="display: none;">
        <strong>üîß –í—ã –≤ —Ä–µ–∂–∏–º–µ —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è!</strong>
        <p style="margin: 5px 0 0 0; font-size: 0.9em;">
          –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏
        </p>
      </div>
      
      <div class="calendar" id="calendar"></div>
      
      <div class="work-stats">
        <h3>üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –Ω–µ–¥–µ–ª–∏</h3>
        <div class="stats-grid">
          <div class="stat-card">
            <div class="stat-value" id="work-days">0</div>
            <div>–†–∞–±–æ—á–∏—Ö –¥–Ω–µ–π</div>
          </div>
          <div class="stat-card">
            <div class="stat-value" id="weekend-days">0</div>
            <div>–í—ã—Ö–æ–¥–Ω—ã—Ö –¥–Ω–µ–π</div>
          </div>
        </div>
        <div style="margin-top: 15px; padding: 12px; background: #e8f5e9; border-radius: 8px;">
          <strong>üïê –ë–ª–∏–∂–∞–π—à–∏–π —Ä–∞–±–æ—á–∏–π –¥–µ–Ω—å:</strong>
          <div id="next-workday-info" style="font-weight: bold; margin-top: 5px;">-</div>
        </div>
      </div>
    </div>
  </div>

  <script>
    const weekdays = ["–ü–Ω", "–í—Ç", "–°—Ä", "–ß—Ç", "–ü—Ç", "–°–±", "–í—Å"];
    let currentMonday = new Date();
    let isEditMode = false;

    // –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ä–µ–∂–∏–º –ø–æ URL
    function checkUrlMode() {
      const urlParams = new URLSearchParams(window.location.search);
      isEditMode = urlParams.get('mode') === 'edit';
      
      if (isEditMode) {
        document.getElementById('editNotice').style.display = 'block';
      }
    }

    const elements = {
      calendar: document.getElementById("calendar"),
      weekRange: document.getElementById("week-range"),
      prevWeek: document.getElementById("prev-week"),
      nextWeek: document.getElementById("next-week")
    };

    function setMonday(date) {
      const monday = new Date(date);
      monday.setDate(date.getDate() - (date.getDay() + 6) % 7);
      return monday;
    }

    function updateTime() {
      const now = new Date();
      document.getElementById("current-time").textContent = 
        `–¢–µ–∫—É—â–µ–µ –≤—Ä–µ–º—è: ${now.toLocaleTimeString('ru-RU')}`;
    }

    function formatWeekRange(monday) {
      const sunday = new Date(monday);
      sunday.setDate(monday.getDate() + 6);
      return `${monday.toLocaleDateString("ru-RU", { day: "2-digit", month: "2-digit" })} - ${sunday.toLocaleDateString("ru-RU", { day: "2-digit", month: "2-digit" })}`;
    }

    function updateCardStyle(card, time) {
      card.style.borderLeft = '4px solid transparent';
      if (time === '07:30') card.style.borderLeftColor = '#4CAF50';
      if (time === '12:00') card.style.borderLeftColor = '#FF9800';
      if (time === '18:00') card.style.borderLeftColor = '#9C27B0';
    }

    function findNextWorkday() {
      const today = new Date();
      let nextDay = new Date(today);
      
      for (let i = 1; i <= 7; i++) {
        nextDay.setDate(today.getDate() + i);
        const dayOfWeek = nextDay.getDay();
        if (dayOfWeek !== 0 && dayOfWeek !== 6) {
          const storageKey = `time_${nextDay.toISOString().split('T')[0]}`;
          const savedTime = localStorage.getItem(storageKey) || '07:30';
          return {
            date: nextDay,
            time: savedTime
          };
        }
      }
      return null;
    }

    function updateStats() {
      const workDays = document.querySelectorAll('.day-card:not(.weekend)').length;
      const weekendDays = document.querySelectorAll('.day-card.weekend').length;
      
      document.getElementById('work-days').textContent = workDays;
      document.getElementById('weekend-days').textContent = weekendDays;
      
      const nextWorkday = findNextWorkday();
      if (nextWorkday) {
        const dateStr = nextWorkday.date.toLocaleDateString("ru-RU", { 
          day: "2-digit", 
          month: "2-digit",
          weekday: 'short'
        });
        document.getElementById('next-workday-info').textContent = 
          `${dateStr} –≤ ${nextWorkday.time}`;
      }
    }

    function renderCalendar() {
      elements.calendar.innerHTML = '';
      const today = new Date();
      elements.weekRange.textContent = formatWeekRange(currentMonday);

      for (let i = 0; i < 7; i++) {
        const day = new Date(currentMonday);
        day.setDate(currentMonday.getDate() + i);

        const card = document.createElement("div");
        card.className = "day-card";

        const isWeekend = i >= 5;
        if (isWeekend) card.classList.add("weekend");
        if (day.toDateString() === today.toDateString()) card.classList.add("today");
        if (day < today && day.toDateString() !== today.toDateString()) {
          card.classList.add("past-day");
        }

        const dateEl = document.createElement("div");
        dateEl.className = "date";
        dateEl.textContent = day.toLocaleDateString("ru-RU", { day: "2-digit", month: "2-digit" });

        const weekdayEl = document.createElement("div");
        weekdayEl.className = "weekday";
        weekdayEl.textContent = weekdays[i];

        card.appendChild(dateEl);
        card.appendChild(weekdayEl);

        if (!isWeekend) {
          const storageKey = `time_${day.toISOString().split('T')[0]}`;
          const savedTime = localStorage.getItem(storageKey) || '07:30';
          
          if (isEditMode) {
            // –†–µ–∂–∏–º —Ä–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞–Ω–∏—è - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º select
            const select = document.createElement("select");
            select.className = "time-select";
            
            ["07:30", "12:00", "18:00"].forEach(time => {
              const option = document.createElement("option");
              option.value = time;
              option.textContent = time;
              if (time === savedTime) option.selected = true;
              select.appendChild(option);
            });

            select.addEventListener('change', () => {
              localStorage.setItem(storageKey, select.value);
              updateCardStyle(card, select.value);
              updateStats();
            });

            card.appendChild(select);
          } else {
            // –†–µ–∂–∏–º –ø—Ä–æ—Å–º–æ—Ç—Ä–∞ - –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Ç–µ–∫—Å—Ç
            const timeDisplay = document.createElement("div");
            timeDisplay.className = "time-display";
            timeDisplay.textContent = savedTime;
            card.appendChild(timeDisplay);
          }
          updateCardStyle(card, savedTime);
        } else {
          // –í—ã—Ö–æ–¥–Ω—ã–µ
          const weekendLabel = document.createElement("div");
          weekendLabel.className = "weekend-label";
          weekendLabel.textContent = "–í—ã—Ö–æ–¥–Ω–æ–π";
          card.appendChild(weekendLabel);
        }

        elements.calendar.appendChild(card);
      }
      updateStats();
    }

    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
    function init() {
      currentMonday = setMonday(new Date());
      checkUrlMode();
      renderCalendar();
      
      elements.prevWeek.addEventListener('click', () => {
        currentMonday.setDate(currentMonday.getDate() - 7);
        renderCalendar();
      });
      
      elements.nextWeek.addEventListener('click', () => {
        currentMonday.setDate(currentMonday.getDate() + 7);
        renderCalendar();
      });

      updateTime();
      setInterval(updateTime, 1000);
    }

    // –ó–∞–ø—É—Å–∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    init();
  </script>
</body>
</html>
